<!DOCTYPE html>
<html>

<head>
    <title>Text Transforms</title>
    <link rel="stylesheet" href="css/textdemo.css">
    <script src="js/scrollx.js" type="text/javascript"></script>
    <script src="js/json_module.js" type="text/javascript"></script>
    <script type="text/javascript">

        // Module/name space TextTransformers
        var TextTransformers = TextTransformers || {
          TxtToHtmlTransformer: function() {
            this.transform = function( txt ) {
              return '<p style="font-style: italic;">' + txt.replace( 'pure', '<b>pure</b>' ) + '</p>';
            }
          },
          HtmlToXmlTransformer: function() {
            this.transform = function( html ) {
              var xml = html.replace( /\<p[^\>]*\>/, '<par>' );
              xml = xml.replace( /\<\/p\>/, '</par>' );
              xml = xml.replace( /\<b\>/, '</emph>' );
              xml = xml.replace( /\<\/b\>/, '</emph>' );
              return xml;
            }
          },
          set_textarea_content: function( textarea_id, content ) {
            var textarea = gEBI( textarea_id );
            textarea.value = content;
          },
          set_iframe_content: function( iframe_id, content ) {
            var iframe = gEBI( iframe_id );
            iframe.contentWindow.document.open();
            iframe.contentWindow.document.write( content );
            iframe.contentWindow.document.close();
          }
        }

        // Code in global name space
        gEBI = function( id ) { return document.getElementById( id ) };

        window.onload = function() {
          // Next will not work with IE, but I don't care about IE.
          if( self==top ){ gEBI( 'demo_panels' ).style.height = ( Math.floor( window.innerHeight * 0.97) ).toString() + 'px' };
          json = new JSON_MODULE();
          json.getExampleJSON( function( json_data ) {
            TextTransformers.set_textarea_content( 'json', JSON.stringify( json_data ) );
          } );
          gEBI( 'to_tei' ).addEventListener( 'click', function() {
            //var rect = gEBI( 'demo_panel_003' ).getBoundingClientRect();
            // console.log( rect );
            // var rect = gEBI( 'demo_panel_002' ).getBoundingClientRect();
            // console.log( rect );
            // rect = gEBI( 'demo_panel_002' ).getBoundingClientRect();
            scrollToX( document.getElementById( 'demo_panel_002' ).offsetLeft, 500, 'easeInOutQuint' );

            var left_x = gEBI( 'demo_panel_002' ).offsetLeft;
            scrollToX( left_x, 500, 'easeInOutQuint' );
            var transformer = new TextTransformers.TxtToHtmlTransformer();
            gEBI( 'tei' ).value = transformer.transform( gEBI( 'json' ).value );
            TextTransformers.set_iframe_content( 'iframe_tei', gEBI( 'tei' ).value );
          } );
          gEBI( 'to_dot' ).addEventListener( 'click', function() {
            var left_x = gEBI( 'demo_panel_003' ).offsetLeft;
            scrollToX( left_x, 500, 'easeInOutQuint' );
            var transformer = new TextTransformers.HtmlToXmlTransformer();
            gEBI( 'dot' ).value = transformer.transform( gEBI( 'tei' ).value );
            TextTransformers.set_iframe_content( 'iframe_dot', gEBI( 'dot' ).value );
          } );
          gEBI( 'back_to_tei' ).addEventListener( 'click', function() {
            var left_x = gEBI( 'demo_panel_002' ).offsetLeft;
            scrollToX( left_x, 500, 'easeInOutQuint' );
          } );
        };
    </script>
</head>
<body>
    <div id="demo_panels">
      <div id="demo_panel_001" class="demo_panel">
        <p>.txt -&gt; HTML -&gt; Shared Canvas JSON -&gt; TEI -&gt; Graph -&gt; HTML</p>
        <textarea id="json"></textarea>
        <iframe id="iframe_json"></iframe>
        <div id="to_tei" class="button">json to tei</div>
      </div>
      <div id="demo_panel_002" class="demo_panel">
        <textarea id="tei"></textarea>
        <iframe id="iframe_tei"></iframe>
        <div id="to_dot" class="button">tei to .dot</div>
      </div>
      <div id="demo_panel_003" class="demo_panel">
        <textarea id="dot"></textarea>
        <iframe id="iframe_dot"></iframe>
        <div id="back_to_tei" class="button">back</div>
      </div>
    </div>
</body>
</html>
