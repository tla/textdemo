<!DOCTYPE html>
<html>

<head>
    <title>Text Transforms</title>
    <link rel="stylesheet" href="css/textdemo.css">
    <script src="js/scrollx.js" type="text/javascript"></script>
    <script type="text/javascript">

        // Module/name space TextTransformers
        var TextTransformers = TextTransformers || {
          TxtToHtmlTransformer: function() {
            this.transform = function( txt ) {
              return '<p style="font-style: italic;">' + txt.replace( 'pure', '<b>pure</b>' ) + '</p>';
            }
          },
          HtmlToXmlTransformer: function() {
            this.transform = function( html ) {
              var xml = html.replace( /\<p[^\>]*\>/, '<par>' );
              xml = xml.replace( /\<\/p\>/, '</par>' );
              xml = xml.replace( /\<b\>/, '</emph>' );
              xml = xml.replace( /\<\/b\>/, '</emph>' );
              return xml;
            }
          },
          set_iframe_content: function( iframe_id, content ) {
            var iframe = gEBI( iframe_id );
            iframe.contentWindow.document.open();
            iframe.contentWindow.document.write( content );
            iframe.contentWindow.document.close();
          }
        }

        // Code in global name space
        gEBI = function( id ) { return document.getElementById( id ) };

        window.onload = function() {
          // Next will not work with IE, but I don't care about IE.
          if( self==top ){ console.log( 'yes' ); gEBI( 'demo_panels' ).style.height = ( Math.floor( window.innerHeight * 0.97) ).toString() + 'px' };
          TextTransformers.set_iframe_content( 'iframe_txt', gEBI( 'txt' ).value );
          gEBI( 'to_html' ).addEventListener( 'click', function() {
            //var rect = gEBI( 'demo_panel_003' ).getBoundingClientRect();
            // console.log( rect );
            // var rect = gEBI( 'demo_panel_002' ).getBoundingClientRect();
            // console.log( rect );
            // rect = gEBI( 'demo_panel_002' ).getBoundingClientRect();
            scrollToX( document.getElementById( 'demo_panel_002' ).offsetLeft, 500, 'easeInOutQuint' );

            var left_x = gEBI( 'demo_panel_002' ).offsetLeft;
            scrollToX( left_x, 500, 'easeInOutQuint' );
            var transformer = new TextTransformers.TxtToHtmlTransformer();
            gEBI( 'html' ).value = transformer.transform( gEBI( 'txt' ).value );
            TextTransformers.set_iframe_content( 'iframe_html', gEBI( 'html' ).value );
          } );
          gEBI( 'to_xml' ).addEventListener( 'click', function() {
            var left_x = gEBI( 'demo_panel_003' ).offsetLeft;
            scrollToX( left_x, 500, 'easeInOutQuint' );
            var transformer = new TextTransformers.HtmlToXmlTransformer();
            gEBI( 'xml' ).value = transformer.transform( gEBI( 'html' ).value );
            TextTransformers.set_iframe_content( 'iframe_xml', gEBI( 'xml' ).value );
          } );
          gEBI( 'back_to_html' ).addEventListener( 'click', function() {
            var left_x = gEBI( 'demo_panel_002' ).offsetLeft;
            scrollToX( left_x, 500, 'easeInOutQuint' );
          } );
        };
    </script>
</head>
<body>
    <div id="demo_panels">
      <div id="demo_panel_001" class="demo_panel">
        <p>.txt -&gt; HTML -&gt; Shared Canvas JSON -&gt; TEI -&gt; Graph -&gt; HTML</p>
        <textarea id="txt">this is less about the market and more about the pure politics side of it</textarea>
        <iframe id="iframe_txt"></iframe>
        <div id="to_html" class="button">text to html</div>
      </div>
      <div id="demo_panel_002" class="demo_panel">
        <textarea id="html"></textarea>
        <iframe id="iframe_html"></iframe>
        <div id="to_xml" class="button">html to xml</div>
      </div>
      <div id="demo_panel_003" class="demo_panel">
        <textarea id="xml"></textarea>
        <iframe id="iframe_xml"></iframe>
        <div id="back_to_html" class="button">back</div>
      </div>
    </div>
</body>
</html>
